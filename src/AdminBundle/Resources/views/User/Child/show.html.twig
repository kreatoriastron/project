{% extends "base.html.twig" %}
 {% block body %}
     {{ parent() }}
         <!-- BEGIN CONTENT -->
         <div class="page-content-wrapper">
             <div class="page-content">
                 <!-- BEGIN PAGE HEAD -->
                 <div class="page-head">
                     <!-- BEGIN PAGE TITLE -->
                     <div class="page-title">
                         <h1>Administracja <small>Dzieci</small></h1>
                     </div>
                     <!-- END PAGE TITLE -->
                 </div>
                 <!-- END PAGE HEAD -->
                 <!-- BEGIN PAGE BREADCRUMB -->
                 <ul class="page-breadcrumb breadcrumb">
                     <li>
                         <a href="javascript:;">Administracja</a><i class="fa fa-circle"></i>
                     </li>
                     <li class="active">
                         Dzieci
                     </li>
                 </ul>
                 <!-- END PAGE BREADCRUMB -->
                 <!-- BEGIN PAGE CONTENT INNER -->
                 <div id="mainBox">
                     <div class="row">
                         <div class="col-md-12">
                             <div class="portlet light">
                                 <div class="portlet-title">
                                     <div class="caption">
                                         <i class="fa fa-gift font-green-sharp"></i>
                                         <span class="caption-subject font-green-sharp bold uppercase">Lista Dzieci</span>
                                     </div>
                                 </div>
                                 <div class="portlet-body">
                                     <div class="table-container" style="">

                                         <div id="datatable_ajax_wrapper" class="dataTables_wrapper dataTables_extended_wrapper no-footer">
                                           <td rowspan="1" colspan="1">
                                                     <div class="margin-bottom-5">
                                                         <button class="btn btn-sm yellow filter-submit margin-bottom" id="search"><i class="fa fa-search"></i> Szukaj</button>
                                                     </div>
                                           </td>

                                         <div class="table-scrollable"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="datatable_ajax" aria-describedby="datatable_ajax_info" role="grid">
                                                     <thead>
                                                     <tr role="row" class="heading">
                                                         <th width="2%" class="sorting_disabled" rowspan="1" colspan="1">
                                                             <div class="checker"><span><input type="checkbox" class="group-checkable"></span></div>
                                                         </th>
                                                         <th width="5%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Imię
                                                         </th>
                                                         <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Nazwisko
                                                         </th>
                                                         <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Imię rodzica
                                                         </th>
                                                         <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Nazwisko rodzica
                                                         </th>
                                                         <th width="45%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Szkoła
                                                         </th>
                                                         <th width="5%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Klasa
                                                         </th>
                                                         <th width="5%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Grupa
                                                         </th>
                                                         <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_ajax" rowspan="1" colspan="1">
                                                             Akcje
                                                         </th>
                                                     </tr>
                                                     <tr role="row" class="filter"><td rowspan="1" colspan="1">
                                                         </td><td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="name">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="surname">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="parent_name">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="parent_surname">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="school">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="class">
                                                         </td>
                                                         <td rowspan="1" colspan="1">
                                                             <input type="text" class="form-control form-filter input-sm" name="group">
                                                         </td>
                                                     </tr>
                                                     </thead>
                                                     <tbody>

                                                         {% for user in users %}
                                                         <tr>
                                                             <td><input type="checkbox" name="id[]" value="{{ user.id }}"></td>
                                                             <td>{{ user.name }}</td>
                                                             <td>{{ user.surname }}</td>
                                                             <td>
                                                                 <a href="{{ path('show_profile_parent', {'userId':user.parentId}) }}" target="_blank">
                                                                     {{ user.parentName }}
                                                                 </a>
                                                             </td>
                                                             <td>
                                                                 <a href="{{ path('show_profile_parent', {'userId':user.parentId}) }}" target="_blank">
                                                                     {{ user.parentSurname }}
                                                                 </a>
                                                             </td>
                                                             <td>
                                                                 <a href="{{ path('edit_school', {'schoolId':user.schoolId}) }}" target="_blank">
                                                                    {{ user.school }}
                                                                </a>
                                                             </td>
                                                             <td>{{ user.class }}</td>
                                                             <td>{{ user.group }}</td>
                                                             <td>
                                                                 <button class="btn btn-sm blue filter-submit margin-bottom actionButton" data-url="{{ path('edit_profile_child', {'userId': user.id}) }}">Edytuj</button>
                                                             </td>
                                                         </tr>
                                                         {% endfor %}
                                                     </tbody>
                                                 </table></div>

                                     </div>
                                 </div>
                             </div>
                             <!-- End: life time stats -->
                         </div>
                     </div>
                 </div>
             </div>
         </div>
 {% endblock %}
 {% block javascripts %}
     {{  parent() }}
     <script type="text/javascript" src="{{ asset('assets/global/plugins/select2/select2.min.js') }}"></script>
     <script>
         $(document).ready(function(){
             $('#search').click(function() {
                 $.ajax({
                     type: "POST",
                     url: '{{ path('filter_child') }}',
                     data: $( ".form-filter" ).serialize(),
                     success: function ($data) {
                         var response= JSON.parse($data);
                         $('#datatable_ajax > tbody tr').remove();
                         $.each(response, function(i, row) {
                             $('<tr>').append(
                                     $('<td>').html('<input type="checkbox" name="id[]" value="' + row.id + '">'),
                                     $('<td>').text(row.name),
                                     $('<td>').text(row.surname),
                                     $('<td>').text(row.parentName),
                                     $('<td>').text(row.parentSurname),
                                     $('<td>').text(row.school),
                                     $('<td>').text(row.class),
                                     $('<td>').text(row.group),
                                     $('<td>').html('<button class="btn btn-sm blue filter-submit margin-bottom actionButton" data-url="/app_dev.php/admin/child/edit/profile/' + row.id + '">Edytuj</button>')
                             ).appendTo('#datatable_ajax > tbody');

                         });

                     }
                 });
             });
             $("#mainBox").on("click",".actionButton", function(){
                 var url = $(this).data('url');
                 window.location = url;
             });

             $("#addParent").click(function(){
                 window.location = "{{ path('add_parent') }}";
             });
         })
     </script>
 {% endblock %}

